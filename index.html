<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Eventure</title>
<style>
  :root {
    --bg-color: #f0f8ff;
    --card-color: #ffffff;
    --primary-color: #0077cc;
    --border-color: #a7d4f3;
    --shadow: 0 2px 8px rgba(0,0,0,0.1);
    --text-color: #000000;
    --spacing: 0.5rem;
    /* Category Colors */
    --music-color: #8b5cf6;
    --music-light: #a78bfa;
    --music-gradient: linear-gradient(135deg, #8b5cf6, #a78bfa, #c4b5fd);
    --sports-color: #10b981;
    --sports-light: #34d399;
    --sports-gradient: linear-gradient(135deg, #10b981, #34d399, #6ee7b7);
    --arts-color: #f59e0b;
    --arts-light: #fbbf24;
    --arts-gradient: linear-gradient(135deg, #f59e0b, #fbbf24, #fcd34d);
    --film-color: #ef4444;
    --film-light: #f87171;
    --film-gradient: linear-gradient(135deg, #ef4444, #f87171, #fca5a5);
    --misc-color: #6b7280;
    --misc-light: #9ca3af;
    --misc-gradient: linear-gradient(135deg, #6b7280, #9ca3af, #d1d5db);
  }
  body.dark {
    --bg-color: #0a0a0a;
    --card-color: #1a1a1a;
    --primary-color: #4da8ff;
    --border-color: #333333;
    --text-color: #ffffff;
    /* Enhanced dark mode gradients with more depth */
    --music-gradient: linear-gradient(135deg, #6b46c1, #8b5cf6, #4c1d95);
    --sports-gradient: linear-gradient(135deg, #047857, #10b981, #065f46);
    --arts-gradient: linear-gradient(135deg, #d97706, #f59e0b, #92400e);
    --film-gradient: linear-gradient(135deg, #dc2626, #ef4444, #991b1b);
    --misc-gradient: linear-gradient(135deg, #4b5563, #6b7280, #374151);
  }
  
  body {
    margin: 0;
    font-family: "Segoe UI",sans-serif;
    background: linear-gradient(135deg, #e0f7ff, #f0f8ff, #dbeafe);
    color: var(--text-color);
    padding: var(--spacing) 1rem;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }
  
  body.dark {
    background: linear-gradient(135deg, #0f172a, #1e293b, #0f1419);
  }
  
  /* Dynamic background overlay based on dominant category */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
    background: var(--current-category-gradient, transparent);
    transition: opacity 0.8s ease;
    pointer-events: none;
    z-index: -1;
  }
  
  body.category-music::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(139, 92, 246, 0.05), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(167, 139, 250, 0.03), transparent 70%);
    opacity: 1;
  }
  
  body.category-sports::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(16, 185, 129, 0.05), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(52, 211, 153, 0.03), transparent 70%);
    opacity: 1;
  }
  
  body.category-arts::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(245, 158, 11, 0.05), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(251, 191, 36, 0.03), transparent 70%);
    opacity: 1;
  }
  
  body.category-film::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(239, 68, 68, 0.05), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(248, 113, 113, 0.03), transparent 70%);
    opacity: 1;
  }
  
  body.category-misc::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(107, 114, 128, 0.05), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(156, 163, 175, 0.03), transparent 70%);
    opacity: 1;
  }
  
  /* Dark mode category backgrounds - more intense */
  body.dark.category-music::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(107, 70, 193, 0.12), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(139, 92, 246, 0.08), transparent 70%),
                                 radial-gradient(ellipse at 50% 80%, rgba(76, 29, 149, 0.06), transparent 70%);
    opacity: 1;
  }
  
  body.dark.category-sports::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(4, 120, 87, 0.12), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(16, 185, 129, 0.08), transparent 70%),
                                 radial-gradient(ellipse at 50% 80%, rgba(6, 95, 70, 0.06), transparent 70%);
    opacity: 1;
  }
  
  body.dark.category-arts::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(217, 119, 6, 0.12), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(245, 158, 11, 0.08), transparent 70%),
                                 radial-gradient(ellipse at 50% 80%, rgba(146, 64, 14, 0.06), transparent 70%);
    opacity: 1;
  }
  
  body.dark.category-film::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(220, 38, 38, 0.12), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(239, 68, 68, 0.08), transparent 70%),
                                 radial-gradient(ellipse at 50% 80%, rgba(153, 27, 27, 0.06), transparent 70%);
    opacity: 1;
  }
  
  body.dark.category-misc::before {
    --current-category-gradient: radial-gradient(ellipse at 20% 50%, rgba(75, 85, 99, 0.12), transparent 70%),
                                 radial-gradient(ellipse at 80% 20%, rgba(107, 114, 128, 0.08), transparent 70%),
                                 radial-gradient(ellipse at 50% 80%, rgba(55, 65, 81, 0.06), transparent 70%);
    opacity: 1;
  }

  .container{max-width:960px;margin:auto;position:relative;z-index:1;}
  .logo-container{display:flex;justify-content:center;margin:var(--spacing) 0;}
  .logo{height:150px;max-width:100%;}
  .logo-light{display:block;}
  .logo-dark{display:none;}
  body.dark .logo-light{display:none;}
  body.dark .logo-dark{display:block;}
  .search-bar{display:flex;flex-wrap:wrap;gap:var(--spacing);justify-content:center;margin-bottom:1rem;}
  input[type="text"],select{padding:0.5rem;font-size:1rem;}
  button{padding:0.5rem 1rem;font-size:1rem;background-color:var(--primary-color);color:white;border:none;border-radius:4px;cursor:pointer;transition:background-color 0.3s ease;}
  button:hover{background-color:#005fa3;}
  button:disabled{opacity:0.5;cursor:not-allowed;}
  
  .event-card{
    display:flex;
    background: var(--card-color);
    border:1px solid var(--border-color);
    border-radius:10px;
    box-shadow:var(--shadow);
    padding:1rem;
    margin:1rem 0;
    gap:1rem;
    transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position:relative;
    overflow:hidden;
    backdrop-filter: blur(10px);
  }
  
  .event-card::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    width:4px;
    height:100%;
    background:var(--category-color, var(--primary-color));
    z-index:1;
  }
  
  /* Category gradient backgrounds for cards */
  .event-card.music {
    --category-color: var(--music-color);
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(139, 92, 246, 0.03) 100%);
  }
  
  .event-card.sports {
    --category-color: var(--sports-color);
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(16, 185, 129, 0.03) 100%);
  }
  
  .event-card.arts {
    --category-color: var(--arts-color);
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(245, 158, 11, 0.03) 100%);
  }
  
  .event-card.film {
    --category-color: var(--film-color);
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(239, 68, 68, 0.03) 100%);
  }
  
  .event-card.misc {
    --category-color: var(--misc-color);
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(107, 114, 128, 0.03) 100%);
  }
  
  /* Enhanced dark mode card gradients */
  body.dark .event-card.music {
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(107, 70, 193, 0.08) 50%, rgba(139, 92, 246, 0.05) 100%);
    border-color: rgba(139, 92, 246, 0.2);
  }
  
  body.dark .event-card.sports {
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(4, 120, 87, 0.08) 50%, rgba(16, 185, 129, 0.05) 100%);
    border-color: rgba(16, 185, 129, 0.2);
  }
  
  body.dark .event-card.arts {
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(217, 119, 6, 0.08) 50%, rgba(245, 158, 11, 0.05) 100%);
    border-color: rgba(245, 158, 11, 0.2);
  }
  
  body.dark .event-card.film {
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(220, 38, 38, 0.08) 50%, rgba(239, 68, 68, 0.05) 100%);
    border-color: rgba(239, 68, 68, 0.2);
  }
  
  body.dark .event-card.misc {
    background: linear-gradient(135deg, var(--card-color) 0%, rgba(75, 85, 99, 0.08) 50%, rgba(107, 114, 128, 0.05) 100%);
    border-color: rgba(107, 114, 128, 0.2);
  }
  
  .event-card:hover{
    transform:scale(1.02) translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }
  
  body.dark .event-card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }
  
  .event-card.music .event-title{color:var(--music-color);}
  .event-card.music .buttons button:first-child{background-color:var(--music-color);}
  .event-card.music .buttons button:first-child:hover{background-color:var(--music-light);}
  .event-card.sports .event-title{color:var(--sports-color);}
  .event-card.sports .buttons button:first-child{background-color:var(--sports-color);}
  .event-card.sports .buttons button:first-child:hover{background-color:var(--sports-light);}
  .event-card.arts .event-title{color:var(--arts-color);}
  .event-card.arts .buttons button:first-child{background-color:var(--arts-color);}
  .event-card.arts .buttons button:first-child:hover{background-color:var(--arts-light);}
  .event-card.film .event-title{color:var(--film-color);}
  .event-card.film .buttons button:first-child{background-color:var(--film-color);}
  .event-card.film .buttons button:first-child:hover{background-color:var(--film-light);}
  .event-card.misc .event-title{color:var(--misc-color);}
  .event-card.misc .buttons button:first-child{background-color:var(--misc-color);}
  .event-card.misc .buttons button:first-child:hover{background-color:var(--misc-light);}

  .event-image{width:150px;height:100px;object-fit:cover;border-radius:8px;}
  .event-content{flex:1;}
  .event-title{font-size:1.25rem;font-weight:bold;}
  .buttons{margin-top:0.75rem;}
  .buttons button{margin-right:0.5rem;}
  .pagination{text-align:center;margin:2rem 0;}
  .pagination button.active{background:var(--border-color);}
  .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);text-align:center;gap:0.25rem;margin-top:1rem;}
  .calendar-grid div{display:flex;justify-content:center;align-items:center;padding:0.75rem;border-radius:6px;background-color:var(--card-color);box-shadow:var(--shadow);cursor:pointer;min-height:40px;}
  .calendar-grid .header{font-weight:bold;cursor:default;}
  .calendar-grid div.today{background-color:gold !important;}
  .calendar-grid div.no-events{opacity:0.4;}
  .calendar-grid div.has-events.music{background-color:var(--music-color);color:white;}
  .calendar-grid div.has-events.sports{background-color:var(--sports-color);color:white;}
  .calendar-grid div.has-events.arts{background-color:var(--arts-color);color:white;}
  .calendar-grid div.has-events.film{background-color:var(--film-color);color:white;}
  .calendar-grid div.has-events.misc{background-color:var(--misc-color);color:white;}
  .calendar-grid div.has-events.mixed{background:linear-gradient(45deg,var(--music-color),var(--sports-color),var(--arts-color));color:white;}
  .calendar-grid div:hover:not(.no-events):not(.header){background-color:var(--border-color);}
  .calendar-grid div.empty{background:none;box-shadow:none;cursor:default;}
  a{color:#cc0077;font-weight:bold;text-decoration:none;}
  @media(max-width:600px){
    .search-bar{flex-direction:column;align-items:center;}
    .event-card{flex-direction:column;align-items:center;}
    .event-title{font-size:1.1rem;}
    .buttons{flex-direction:column;}
    .event-image{width:100%;height:auto;}
  }
  .settings-container{position:absolute;top:0.5rem;right:1rem;}
  #settingsMenu{display:none;position:absolute;right:0;background:var(--card-color);color:var(--text-color);border:1px solid var(--border-color);border-radius:6px;padding:0.5rem;margin-top:0.5rem;box-shadow:var(--shadow);z-index:100;}
  #settingsMenu label{display:block;margin-bottom:0.5rem;}
  .settings-container button{background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--text-color);}
  .back-to-all{text-align:center;margin:1rem 0;}
  .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);backdrop-filter:blur(3px);}
  .modal-content{background-color:var(--card-color);margin:5% auto;padding:0;border-radius:10px;width:90%;max-width:800px;max-height:80vh;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.3);}
  .modal-header{background-color:var(--primary-color);color:white;padding:1rem;display:flex;justify-content:space-between;align-items:center;}
  .modal-header h3{margin:0;font-size:1.2rem;}
  .close{color:white;font-size:24px;font-weight:bold;cursor:pointer;background:none;border:none;}
  .close:hover{opacity:0.7;}
  .modal-body{padding:0;height:400px;}
  .map-container{width:100%;height:100%;}
  .map-container iframe{width:100%;height:100%;border:none;}
  @media(max-width:600px){
    .modal-content{width:95%;margin:10% auto;}
    .modal-body{height:300px;}
  }
</style>
</head>
<body>
<div class="settings-container">
  <button id="settingsBtn">‚öôÔ∏è</button>
  <div id="settingsMenu">
    <label>üåê 
      <select id="langSelect">
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
        <option value="fr">Fran√ßais</option>
      </select>
    </label>
    <label><input type="checkbox" id="darkToggle"/> üåô Dark Mode</label>
  </div>
</div>
<div class="container">
  <div class="logo-container">
    <img src="logo-light.png" alt="Light Logo" class="logo logo-light">
    <img src="logo-dark.png" alt="Dark Logo" class="logo logo-dark">
  </div>
  <div class="search-bar">
    <label for="city" id="labelCity">City:</label>
    <input type="text" id="city" placeholder="Enter city"/>
    <label for="category" id="labelCategory">Category:</label>
    <select id="category">
      <option value="All">All</option>
      <option value="Music">Music</option>
      <option value="Sports">Sports</option>
      <option value="Arts & Theater">Arts & Theater</option>
      <option value="Film">Film</option>
      <option value="Miscellaneous">Miscellaneous</option>
    </select>
    <button id="btnSearch">Search</button>
    <button id="btnCalendar">üìÖ View Calendar</button>
  </div>
  <div id="calendar" style="display:none;"></div>
  <div class="back-to-all" id="backToAll" style="display:none;">
    <button onclick="showAllEvents()">‚Üê Show All Events</button>
  </div>
  <div id="results"></div>
</div>

<!-- Map Modal -->
<div id="mapModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">Venue Location</h3>
      <button class="close" onclick="closeMapModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="map-container">
        <iframe id="mapFrame" src="" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>
  </div>
</div>
<script>
const apiKey='qGDnOricwKqTRb66e5xyDWPYOWsQGDCT';
let allEvents=[],displayEvents=[],currentLang='en',currentPage=1;
const perPage=10;
let calendarMonth=new Date().getMonth();
let calendarYear=new Date().getFullYear();
let isFilteredByDate = false;
const langData={en:{city:"City:",category:"Category:",All:"All",Music:"Music",Sports:"Sports","Arts & Theater":"Arts & Theater",Film:"Film",Miscellaneous:"Miscellaneous",Search:"Search","üìÖ View Calendar":"üìÖ View Calendar","No events on":"No events on",placeholder:"Enter city"},
es:{city:"Ciudad:",category:"Categor√≠a:",All:"Todas",Music:"M√∫sica",Sports:"Deportes","Arts & Theater":"Arte & Teatro",Film:"Cine",Miscellaneous:"Miscel√°neo",Search:"Buscar","üìÖ View Calendar":"üìÖ Ver calendario","No events on":"No hay eventos el",placeholder:"Introduce ciudad"},
fr:{city:"Ville:",category:"Cat√©gorie:",All:"Toutes",Music:"Musique",Sports:"Sport","Arts & Theater":"Arts & Th√©√¢tre",Film:"Cin√©ma",Miscellaneous:"Divers",Search:"Rechercher","üìÖ View Calendar":"üìÖ Voir calendrier","No events on":"Aucun √©v√©nement le",placeholder:"Entrez ville"}};

function setLanguage(){
  currentLang=document.getElementById('langSelect').value;
  localStorage.setItem('lang',currentLang);
  const t=langData[currentLang];
  document.getElementById('labelCity').textContent=t.city;
  document.getElementById('city').placeholder=t.placeholder;
  document.getElementById('labelCategory').textContent=t.category;
  Array.from(document.getElementById('category').options).forEach(opt=>{opt.textContent=t[opt.value]||opt.value});
  document.getElementById('btnSearch').textContent=t.Search;
  document.getElementById('btnCalendar').textContent=t["üìÖ View Calendar"];
}
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem('darkMode',document.body.classList.contains('dark'));
}

// Function to update body class based on dominant category
function updateBackgroundGradient() {
  // Remove all existing category classes
  document.body.classList.remove('category-music', 'category-sports', 'category-arts', 'category-film', 'category-misc');
  
  if (displayEvents.length === 0) return;
  
  // Count categories in current display
  const categoryCount = {};
  displayEvents.forEach(event => {
    const category = getCategoryClass(event);
    categoryCount[category] = (categoryCount[category] || 0) + 1;
  });
  
  // Find dominant category
  const dominantCategory = Object.keys(categoryCount).reduce((a, b) => 
    categoryCount[a] > categoryCount[b] ? a : b
  );
  
  // Apply the dominant category class to body
  document.body.classList.add(`category-${dominantCategory}`);
}

function searchEvents(){
  const city=document.getElementById('city').value;
  const category=document.getElementById('category').value;
  localStorage.setItem('lastCity',city);
  localStorage.setItem('lastCategory',category);
  const classification=category==='All'?'':`&classificationName=${encodeURIComponent(category)}`;
  fetch(`https://app.ticketmaster.com/discovery/v2/events.json?apikey=${apiKey}&city=${encodeURIComponent(city)}&size=200${classification}`)
    .then(res=>res.json()).then(data=>{
      allEvents=data._embedded?.events||[];
      displayEvents=[...allEvents];
      currentPage=1;
      isFilteredByDate = false;
      document.getElementById('backToAll').style.display = 'none';
      renderPage();
      renderCalendar();
      updateBackgroundGradient();
    });
}
function renderPagination(){
  const totalPages=Math.ceil(displayEvents.length/perPage);
  if(totalPages <= 1) return;
  
  const pagDiv=document.createElement('div');
  pagDiv.className='pagination';
  const addBtn=(label,page)=>{const b=document.createElement('button');b.textContent=label;if(page===currentPage)b.classList.add('active');b.onclick=()=>{currentPage=page;renderPage()};pagDiv.appendChild(b)}
  if(totalPages<=7){for(let i=1;i<=totalPages;i++)addBtn(i,i);}
  else{
    addBtn(1,1);
    if(currentPage>3)pagDiv.append('...');
    for(let i=Math.max(2,currentPage-1);i<=Math.min(totalPages-1,currentPage+1);i++)addBtn(i,i);
    if(currentPage<totalPages-2)pagDiv.append('...');
    addBtn(totalPages,totalPages);
  }
  document.getElementById('results').appendChild(pagDiv);
}
function getCategoryClass(event) {
  const classifications = event.classifications || [];
  const segment = classifications[0]?.segment?.name?.toLowerCase() || '';
  const genre = classifications[0]?.genre?.name?.toLowerCase() || '';
  
  if (segment.includes('music') || genre.includes('music')) return 'music';
  if (segment.includes('sports') || genre.includes('sports')) return 'sports';
  if (segment.includes('arts') || segment.includes('theatre') || genre.includes('theatre') || genre.includes('arts')) return 'arts';
  if (segment.includes('film') || genre.includes('film') || genre.includes('movie')) return 'film';
  return 'misc';
}

function getCategoryEmoji(categoryClass) {
  const emojis = {
    music: 'üéµ',
    sports: '‚öΩ',
    arts: 'üé≠',
    film: 'üé¨',
    misc: 'üé™'
  };
  return emojis[categoryClass] || 'üé™';
}

function renderEventCard(e){
  const v=e._embedded.venues[0];
  const categoryClass = getCategoryClass(e);
  const categoryEmoji = getCategoryEmoji(categoryClass);
  
  return `<div class="event-card ${categoryClass}">
    <img src="${e.images?.[0]?.url||''}" loading="lazy" alt="${e.name}" class="event-image"/>
    <div class="event-content">
      <div class="event-title">${categoryEmoji} ${e.name}</div>
      <div class="event-details">
        <p><strong>Venue:</strong> ${v.name}</p>
        <p><strong>Date:</strong> ${e.dates.start.localDate}</p>
        <p><strong>Time:</strong> ${e.dates.start.localTime||'TBA'}</p>
        <p><a href="${e.url}" target="_blank">üéüÔ∏è Tickets</a></p>
      </div>
      <div class="buttons">
        <button onclick="openInlineMap('${v.name}','${v.city.name}')">üó∫Ô∏è Map</button>
        <button onclick="openUber('${v.name}','${v.city.name}')">üöó Uber</button>
        <button onclick="openLyft('${v.name}','${v.city.name}')">üöï Lyft</button>
      </div>
    </div>
  </div>`;
}
function renderPage(){
  const resultsDiv=document.getElementById('results');
  resultsDiv.innerHTML='';
  const start=(currentPage-1)*perPage;
  const eventsToShow = displayEvents.slice(start,start+perPage);
  
  if(eventsToShow.length === 0) {
    resultsDiv.innerHTML = '<p style="text-align:center;margin:2rem 0;">No events found.</p>';
    return;
  }
  
  resultsDiv.innerHTML+=eventsToShow.map(renderEventCard).join('');
  renderPagination();
}
function toggleCalendar(){
  const c=document.getElementById('calendar');
  c.style.display=c.style.display==='none'?'block':'none';
  if(c.style.display === 'block') {
    renderCalendar();
  }
}
function renderCalendar(){
  const now=new Date();
  const todayDate=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
  const y=calendarYear,m=calendarMonth;
  
  // Get first day of month and number of days
  const firstDay = new Date(y, m, 1);
  const lastDay = new Date(y, m + 1, 0);
  const firstDayOfWeek = firstDay.getDay(); // 0 = Sunday
  const daysInMonth = lastDay.getDate();
  
  let html=`<div style="text-align:center;margin-bottom:0.5rem;">
    <button onclick="changeMonth(-1)">‚¨ÖÔ∏è</button>
    <strong>${new Date(y,m).toLocaleString('default',{month:'long'})} ${y}</strong>
    <button onclick="changeMonth(1)">‚û°Ô∏è</button>
  </div><div class="calendar-grid">`;
  
  // Add day headers
  ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d=>html+=`<div class="header"><strong>${d}</strong></div>`);
  
  // Add empty cells for days before the first day of month
  for(let i=0;i<firstDayOfWeek;i++){
    html+=`<div class="empty"></div>`;
  }
  
  // Add days of the month
  for(let day=1;day<=daysInMonth;day++){
    const dateStr=`${y}-${String(m+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const dayEvents = allEvents.filter(e=>e.dates.start.localDate===dateStr);
    const hasEvent = dayEvents.length > 0;
    
    let classes=[];
    let clickHandler='';
    
    if(dateStr===todayDate){
      classes.push('today');
    }
    
    if(hasEvent){
      // Determine dominant category for the day
      const categories = dayEvents.map(e => getCategoryClass(e));
      const categoryCount = {};
      categories.forEach(cat => categoryCount[cat] = (categoryCount[cat] || 0) + 1);
      
      const dominantCategory = Object.keys(categoryCount).reduce((a, b) => 
        categoryCount[a] > categoryCount[b] ? a : b
      );
      
      // If multiple categories, use mixed
      const uniqueCategories = [...new Set(categories)];
      if(uniqueCategories.length > 2) {
        classes.push('has-events', 'mixed');
      } else {
        classes.push('has-events', dominantCategory);
      }
      
      clickHandler=`onclick="filterByDate('${dateStr}')"`;
    } else {
      classes.push('no-events');
    }
    
    html+=`<div class="${classes.join(' ')}" ${clickHandler}>${day}</div>`;
  }
  
  // Fill remaining cells to complete the grid (42 total cells = 6 rows √ó 7 days)
  const totalCells = firstDayOfWeek + daysInMonth;
  const remainingCells = 42 - totalCells;
  for(let i=0;i<remainingCells;i++){
    html+=`<div class="empty"></div>`;
  }
  
  html+='</div>';
  document.getElementById('calendar').innerHTML=html;
}
function changeMonth(offset){
  calendarMonth+=offset;
  if(calendarMonth<0){calendarMonth=11;calendarYear--;}
  else if(calendarMonth>11){calendarMonth=0;calendarYear++;}
  renderCalendar();
}
function filterByDate(dateStr){
  displayEvents = allEvents.filter(e=>e.dates.start.localDate===dateStr);
  currentPage=1;
  isFilteredByDate = true;
  document.getElementById('backToAll').style.display = 'block';
  renderPage();
  updateBackgroundGradient();
  
  // Close calendar view
  document.getElementById('calendar').style.display = 'none';
}
function showAllEvents(){
  displayEvents = [...allEvents];
  currentPage = 1;
  isFilteredByDate = false;
  document.getElementById('backToAll').style.display = 'none';
  renderPage();
  updateBackgroundGradient();
}
function openInlineMap(venueName, cityName){
  const query = encodeURIComponent(`${venueName}, ${cityName}`);
  // Use OpenStreetMap as a fallback - no API key required
  const embedUrl = `https://www.openstreetmap.org/export/embed.html?bbox=-180,-85,180,85&layer=mapnik&marker=0,0`;
  
  document.getElementById('modalTitle').textContent = `üìç ${venueName}`;
  
  // Create a custom iframe content with multiple map options
  const mapContent = `
    <div style="height:100%;display:flex;flex-direction:column;font-family:Arial,sans-serif;">
      <div style="padding:15px;background:#f5f5f5;border-bottom:1px solid #ddd;">
        <h4 style="margin:0 0 10px 0;color:#333;">üìç ${venueName}</h4>
        <p style="margin:0;color:#666;font-size:14px;">üìç ${cityName}</p>
      </div>
      <div style="flex:1;padding:20px;display:flex;flex-direction:column;gap:15px;">
        <div style="display:flex;flex-wrap:wrap;gap:10px;">
          <a href="https://www.google.com/maps/search/?api=1&query=${query}" 
             target="_blank" 
             style="background:#4285f4;color:white;padding:12px 20px;text-decoration:none;border-radius:5px;font-weight:bold;display:inline-block;">
            üó∫Ô∏è Open in Google Maps
          </a>
          <a href="https://www.openstreetmap.org/search?query=${query}" 
             target="_blank" 
             style="background:#7EBC6F;color:white;padding:12px 20px;text-decoration:none;border-radius:5px;font-weight:bold;display:inline-block;">
            üåç Open in OpenStreetMap
          </a>
        </div>
        <div style="background:#f9f9f9;padding:15px;border-radius:8px;border-left:4px solid #4285f4;">
          <h5 style="margin:0 0 8px 0;color:#333;">Quick Actions:</h5>
          <div style="display:flex;flex-wrap:wrap;gap:8px;">
            <a href="https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${query}" 
               target="_blank" 
               style="background:#000;color:white;padding:8px 15px;text-decoration:none;border-radius:20px;font-size:13px;">
              üöó Get Uber
            </a>
            <a href="https://lyft.com/ride?destination[address]=${query}" 
               target="_blank" 
               style="background:#ff00bf;color:white;padding:8px 15px;text-decoration:none;border-radius:20px;font-size:13px;">
              üöï Get Lyft
            </a>
          </div>
        </div>
        <div style="background:#e8f5e8;padding:15px;border-radius:8px;">
          <p style="margin:0;font-size:14px;color:#2e7d2e;">
            üí° <strong>Tip:</strong> Click on the map links above to get directions, view street view, and explore the area around the venue.
          </p>
        </div>
      </div>
    </div>
  `;
  
  document.getElementById('mapFrame').srcdoc = mapContent;
  document.getElementById('mapModal').style.display = 'block';
}
function closeMapModal(){
  document.getElementById('mapModal').style.display = 'none';
  document.getElementById('mapFrame').srcdoc = '';
  document.getElementById('mapFrame').src = '';
}
function openMap(v,c){window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(v+', '+c)}`,'_blank')}
function openUber(v,c){window.open(`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[formatted_address]=${encodeURIComponent(v+', '+c)}`,'_blank')}
function openLyft(v,c){window.open(`https://lyft.com/ride?destination[address]=${encodeURIComponent(v+', '+c)}`,'_blank')}

// Event listeners
document.getElementById("settingsBtn").addEventListener("click",()=>{const m=document.getElementById("settingsMenu");m.style.display=m.style.display==="block"?"none":"block";});
document.getElementById("langSelect").addEventListener("change",setLanguage);
document.getElementById("darkToggle").addEventListener("change",toggleDark);
document.getElementById("btnSearch").addEventListener("click",searchEvents);
document.getElementById("btnCalendar").addEventListener("click",toggleCalendar);

// Close modal when clicking outside of it
window.onclick = function(event) {
  const modal = document.getElementById('mapModal');
  if (event.target === modal) {
    closeMapModal();
  }
}

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeMapModal();
  }
});

// Initialize from localStorage
if(localStorage.getItem('lang'))document.getElementById('langSelect').value=localStorage.getItem('lang');
if(localStorage.getItem('darkMode')==='true'){
  document.body.classList.add('dark');
  document.getElementById('darkToggle').checked = true;
}
if(localStorage.getItem('lastCity'))document.getElementById('city').value=localStorage.getItem('lastCity');
if(localStorage.getItem('lastCategory'))document.getElementById('category').value=localStorage.getItem('lastCategory');
setLanguage();
